version: '3'
services:

  ######### INFRASTRUCTURE #########
  mosquitto:
    image: eclipse-mosquitto
    volumes: 
     - ./infrastructure/mosquitto/mosquitto.conf:/mosquitto/config/mosquitto.conf

  warehouse-management:
    build: ./WarehouseManagement
    # ports: 
    depends_on: 
      - placement
  
  warehouse-management-dapr:
    image: "daprio/daprd:edge"
    command: [
      "./daprd",
     "-app-id", "WarehouseManagement",
     "-app-port", "80",
     "-placement-host-address", "placement:50006"
     ]
    volumes:
        - "./dapr/components/:/components"
    depends_on:
      - WarehouseManagement
    network_mode: "service:warehouse-management"


  placement:
    image: "daprio/dapr"
    command: ["./placement", "-port", "50006"]
    ports:
      - "50006:50006"